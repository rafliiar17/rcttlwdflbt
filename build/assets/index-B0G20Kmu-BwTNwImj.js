import{C as t,w as P}from"./index-CWlcsfJx.js";import{t as I,Q as L,e as k,b as z,D as A,w as H}from"./proxy-CwtEobr4-BmSVccJ_.js";class S extends t.Component{getSnapshotBeforeUpdate(u){const e=this.props.childRef.current;if(e&&u.isPresent&&!this.props.isPresent){const r=e.offsetParent,f=r instanceof HTMLElement&&r.offsetWidth||0,n=this.props.sizeRef.current;n.height=e.offsetHeight||0,n.width=e.offsetWidth||0,n.top=e.offsetTop,n.left=e.offsetLeft,n.right=f-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}}function U({children:c,isPresent:u,anchorX:e}){const r=t.useId(),f=t.useRef(null),n=t.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:p}=t.useContext(H);return t.useInsertionEffect(()=>{const{width:x,height:o,top:C,left:s,right:d}=n.current;if(u||!f.current||!x||!o)return;const a=e==="left"?`left: ${s}`:`right: ${d}`;f.current.dataset.motionPopId=r;const l=document.createElement("style");return p&&(l.nonce=p),document.head.appendChild(l),l.sheet&&l.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${x}px !important;
            height: ${o}px !important;
            ${a}px !important;
            top: ${C}px !important;
          }
        `),()=>{document.head.removeChild(l)}},[u]),P.jsx(S,{isPresent:u,childRef:f,sizeRef:n,children:t.cloneElement(c,{ref:f})})}const Q=({children:c,initial:u,isPresent:e,onExitComplete:r,custom:f,presenceAffectsLayout:n,mode:p,anchorX:x})=>{const o=L(T),C=t.useId(),s=t.useCallback(a=>{o.set(a,!0);for(const l of o.values())if(!l)return;r&&r()},[o,r]),d=t.useMemo(()=>({id:C,initial:u,isPresent:e,custom:f,onExitComplete:s,register:a=>(o.set(a,!1),()=>o.delete(a))}),n?[Math.random(),s]:[e,s]);return t.useMemo(()=>{o.forEach((a,l)=>o.set(l,!1))},[e]),t.useEffect(()=>{!e&&!o.size&&r&&r()},[e]),p==="popLayout"&&(c=P.jsx(U,{isPresent:e,anchorX:x,children:c})),P.jsx(A.Provider,{value:d,children:c})};function T(){return new Map}const w=c=>c.key||"";function j(c){const u=[];return t.Children.forEach(c,e=>{t.isValidElement(e)&&u.push(e)}),u}const F=({children:c,custom:u,initial:e=!0,onExitComplete:r,presenceAffectsLayout:f=!0,mode:n="sync",propagate:p=!1,anchorX:x="left"})=>{const[o,C]=I(p),s=t.useMemo(()=>j(c),[c]),d=p&&!o?[]:s.map(w),a=t.useRef(!0),l=t.useRef(s),E=L(()=>new Map),[X,b]=t.useState(s),[m,v]=t.useState(s);k(()=>{a.current=!1,l.current=s;for(let h=0;h<m.length;h++){const i=w(m[h]);d.includes(i)?E.delete(i):E.get(i)!==!0&&E.set(i,!1)}},[m,d.length,d.join("-")]);const R=[];if(s!==X){let h=[...s];for(let i=0;i<m.length;i++){const g=m[i],$=w(g);d.includes($)||(h.splice(i,0,g),R.push(g))}n==="wait"&&R.length&&(h=R),v(j(h)),b(s);return}const{forceRender:y}=t.useContext(z);return P.jsx(P.Fragment,{children:m.map(h=>{const i=w(h),g=p&&!o?!1:s===m||d.includes(i),$=()=>{if(E.has(i))E.set(i,!0);else return;let M=!0;E.forEach(D=>{D||(M=!1)}),M&&(y==null||y(),v(l.current),p&&(C==null||C()),r&&r())};return P.jsx(Q,{isPresent:g,initial:!a.current||e?void 0:!1,custom:g?void 0:u,presenceAffectsLayout:f,mode:n,onExitComplete:g?void 0:$,anchorX:x,children:h},i)})})};export{F as G};
